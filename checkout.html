<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" content="initial-scale=1" />
    <title>GuidEd by Stacy</title>
    <link rel="stylesheet" href="CSS/checkout.css" />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <script id="navbarHeightScript">
      window.onscroll = function () {
        scrollFunction();
      };
      var r = document.querySelector(":root");
      var timer = null;

      function scrollFunction() {
        r.style.setProperty("--scrollbarColor", "#a8ead5");
        if (
          document.body.scrollTop > 1 ||
          document.documentElement.scrollTop > 1
        ) {
          r.style.setProperty("--navbarHeight", "10vh");
        } else {
          r.style.setProperty("--navbarHeight", "12vh");
        }
        if (timer !== null) {
          clearTimeout(timer);
        }
        timer = setTimeout(function () {
          r.style.setProperty("--scrollbarColor", "#dae3bb");
        }, 100);
      }
    </script>
    <script type="text/javascript" src="JS/products.js"></script>
    <script id="cartScript" type="text/javascript">
      function displayCart(bool) {
        if (bool) {
          document.getElementById("cartBackdrop").style.display = "flex";
          createCartElements();
        } else {
          document.getElementById("cartBackdrop").style.display = "none";
        }
      }

      function addToCart(productString) {
        let cart = JSON.parse(getCookie("cart") || "[]");
        if (!cart.includes(productString)) {
          cart.push(productString);
          setCookie("cart", JSON.stringify(cart));
          displayCart(true);
        }
      }
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(";").shift();
      }
      function setCookie(name, value) {
        document.cookie = `${name}=${value}; path=/`;
      }

      function createCartElements() {
        let cart = JSON.parse(getCookie("cart") || "[]");
        let cartContainer = document.getElementById("cartDisplayContainer");

        cartContainer.innerHTML =
          "<div id=" +
          "cartDisplayHeading" +
          ">" +
          "<div id=" +
          "cartDisplayTitle" +
          ">Backpack</div>" +
          "<div id=" +
          "cartDisplayCount" +
          `>${cart.length} Items</div>` +
          "<div id=" +
          "cartDisplayX" +
          " " +
          "onClick=" +
          "displayCart(false)" +
          "></div> </div>" +
          "<div id=" +
          "cartCheckoutContainer" +
          "> <div id=" +
          "cartCheckoutText" +
          "> Found everything you need? <br />Let's prepare your digital downloads! </div>" +
          "<div id=" +
          "cartCheckoutButton" +
          ">Check Out</div> </div>";

        cart.forEach((product) => {
          var name = window[product].name;
          var subject = window[product].subject;
          var im1 = window[product].im1;
          cartContainer.innerHTML += `
            <div class="cartItemContainer">
            <div class="cartItemImage" style="background-image: url('${im1}') "></div>
            <div class="cartItemInfoBox">
              <div class="cartItemName"> ${name} </div>
              <div class="cartItemSubject"> ${subject} </div>
              <div class="cartItemRemove" onClick="removeFromCart('${product}')"> remove </div>
            </div>
          </div>`;
        });
      }

      function removeFromCart(productString) {
        let cart = JSON.parse(getCookie("cart") || "[]");
        cart = cart.filter((product) => product !== productString);
        setCookie("cart", JSON.stringify(cart));
        createCartElements();
      }

      // Call the displayCart function on the cart page to show the cart contents
      // if (window.location.href.includes("cart.html")) {
      //   displayCart();
      // }
    </script>
    <script id="rememberMeScript">
      function updateRememberMe() {
        var remCheck = document.getElementById("rememberMeCheck");
        let rememberMe = [];
        if (remCheck.checked) {
          rememberMe.push(document.getElementById("firstNameInput").value);
          rememberMe.push(document.getElementById("lastNameInput").value);
          rememberMe.push(document.getElementById("emailInput").value);
          rememberMe.push(document.getElementById("gradeInput").value);
          rememberMe.push(document.getElementById("cityStateInput").value);
          if (document.getElementById("emailSignUpCheck").checked) {
            rememberMe.push("yes");
          } else {
            rememberMe.push("no");
          }
        }
        setCookie("rememberMe", JSON.stringify(rememberMe));
        console.log(rememberMe);
      }
      document.addEventListener(
        "DOMContentLoaded",
        (loadContent = () => {
          let rememberMe = JSON.parse(getCookie("rememberMe") || "[]");
          createCartElements();
          if (rememberMe.length !== 0) {
            console.log(rememberMe);
            document.getElementById("firstNameInput").value = rememberMe[0];
            document.getElementById("lastNameInput").value = rememberMe[1];
            document.getElementById("emailInput").value = rememberMe[2];
            document.getElementById("gradeInput").value = rememberMe[3];
            document.getElementById("cityStateInput").value = rememberMe[4];
            if (rememberMe[5] === "yes") {
              document.getElementById("emailSignUpCheck").checked = true;
            } else document.getElementById("emailSignUpCheck").checked = false;
            document.getElementById("rememberMeCheck").checked = true;
          } else {
            document.getElementById("firstNameInput").value = "function check";
            document.getElementById("rememberMeCheck").checked = false;
            document.getElementById("emailSignUpCheck").checked = false;
          }
        })
      );
    </script>
  </head>
  <body>
    <div id="checkoutContainer">
      <div id="checkoutBox">
        <div id="navbarLogoContainer">
          <div id="navbarMainLogo">GuidEd</div>
          <div id="navbarSubLogo">By Stacy</div>
        </div>
        <form id="checkoutForm">
          <div id="checkoutTitle">Checkout</div>
          <input
            id="firstNameInput"
            class="formSmallInput"
            placeholder="First Name*"
          />
          <input
            id="lastNameInput"
            class="formSmallInput"
            placeholder="Last Name*"
          />
          <input
            id="emailInput"
            class="formLargeInput"
            type="email"
            placeholder="Email*"
          />
          <input
            id="gradeInput"
            class="formSmallInput"
            placeholder="Grade Level (Optional)"
          />
          <input
            id="cityStateInput"
            class="formSmallInput"
            placeholder="City, State (Optional)"
          />
          <label class="container"
            >Remember Me
            <input id="rememberMeCheck" type="checkbox" checked="checked" />
            <span class="checkmark"></span>
          </label>
          <label class="container"
            >Email me with news and updates
            <input id="emailSignUpCheck" type="checkbox" checked="checked" />
            <span class="checkmark"></span>
          </label>
          <div id="checkoutButtonContainer">
            <div id="checkoutButton" onClick="updateRememberMe()">Checkout</div>
          </div>
        </form>
      </div>
      <div id="cartDisplayContainer">
        <div id="cartDisplayHeading">
          <div id="cartDisplayTitle">Backpack</div>
          <div id="cartDisplayCount">0 Items</div>
          <div id="cartDisplayX"></div>
        </div>
        <div id="cartCheckoutContainer">
          <div id="cartCheckoutText">
            We will <b> email </b> your order as <b>free</b> digital files! Most
            orders are processed instantly, but please allow up to a day before
            reaching out!
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
